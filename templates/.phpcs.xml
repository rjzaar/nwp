<?xml version="1.0"?>
<!--
  NWP PHPCS Configuration Template
  Copy this to your site's root directory

  Usage:
    ddev exec vendor/bin/phpcs
    ddev exec vendor/bin/phpcbf (auto-fix)
-->
<ruleset name="NWP Drupal">
  <description>PHP CodeSniffer configuration for NWP Drupal sites</description>

  <!-- Arguments -->
  <arg name="colors"/>
  <arg name="extensions" value="php,module,inc,install,test,profile,theme,css,info,txt,md,yml"/>
  <arg name="parallel" value="8"/>
  <arg value="sp"/><!-- Show sniff names and progress -->

  <!-- Include Drupal coding standards -->
  <rule ref="Drupal">
    <!-- Exclude some rules that are too strict for custom code -->
    <exclude name="Drupal.Commenting.InlineComment.SpacingAfter"/>
  </rule>

  <!-- Include Drupal best practices -->
  <rule ref="DrupalPractice">
    <!-- Exclude overly strict rules -->
    <exclude name="DrupalPractice.Commenting.ExpectedException"/>
  </rule>

  <!-- Paths to check -->
  <file>web/modules/custom</file>
  <file>web/themes/custom</file>

  <!-- Alternative paths for different webroots -->
  <!-- <file>html/modules/custom</file> -->
  <!-- <file>html/themes/custom</file> -->

  <!-- Paths to ignore -->
  <exclude-pattern>*/node_modules/*</exclude-pattern>
  <exclude-pattern>*/vendor/*</exclude-pattern>
  <exclude-pattern>*.min.js</exclude-pattern>
  <exclude-pattern>*.min.css</exclude-pattern>
  <exclude-pattern>*/tests/*Test.php</exclude-pattern>
  <exclude-pattern>*/tests/fixtures/*</exclude-pattern>
  <exclude-pattern>*/.ddev/*</exclude-pattern>
  <exclude-pattern>*/files/*</exclude-pattern>

  <!-- Line length limit (warning at 80, error at 120) -->
  <rule ref="Drupal.Files.LineLength">
    <properties>
      <property name="lineLimit" value="120"/>
      <property name="absoluteLineLimit" value="0"/><!-- No hard limit -->
    </properties>
  </rule>

  <!-- Allow long array lines for configuration -->
  <rule ref="Drupal.Arrays.Array.LongLineDeclaration">
    <severity>0</severity>
  </rule>

  <!-- Report format for CI -->
  <arg name="report" value="full"/>
  <!-- Add checkstyle for CI integration: --report=checkstyle --report-file=reports/phpcs.xml -->

  <!-- PHP version check -->
  <config name="testVersion" value="8.1-"/>

  <!-- Installed paths for standards -->
  <config name="installed_paths" value="../../drupal/coder/coder_sniffer,../../sirbrillig/phpcs-variable-analysis,../../slevomat/coding-standard"/>

</ruleset>
