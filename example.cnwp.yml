# This is the config file for the Narrow Way Project
# The aim is to put reasonable default values to make running the nwp easy
# particularly for beginners.

# This recipe section will have defaults to easy start a new project.
settings:
  # Stack settings
  database: mariadb
  php: 8.2
  webserver: nginx
  os: ubuntu

  # CLI settings
  # Do you want to install nwp with a universal cli prompt for scipts, eg 'pl' ie instead of only running
  # the install script in the root nwp directory, it could be run from anywhere using the command 'pl'
  # eg 'pl install d' anywhere instead of './install d' only in the nwp directory.
  cli: y
  cliprompt: pl

  # Deployment settings
  # linodeuse: testing/gitlab/all. If left blank it means no use.
  linodeuse:
  # urluse: testing/gitlab/all. If left blank it means no use.
  urluse:
  # url is for providing live tests and nwp site.
  url:

  # Default environment configuration (can be overridden per recipe)
  environment:
    development:
      debug: true                   # Enable debug mode
      xdebug: false                 # XDebug off by default
      database_import: always       # Always import database
      stage_file_proxy: false       # Disabled by default
    staging:
      debug: false
      database_sanitize: true       # Sanitize database on import
      stage_file_proxy: true
    production:
      debug: false
      database_sanitize: false
      redis: true                   # Enable Redis in production
      caching: aggressive

  # Default services configuration (can be overridden per recipe)
  services:
    redis:
      enabled: false                # Redis disabled by default
      version: "7"
    solr:
      enabled: false                # Solr disabled by default
      version: "8"
      core: drupal
    memcache:
      enabled: false

  # Site management settings
  delete_site_yml: true             # Remove site from cnwp.yml when deleted (use --keep-yml to preserve) 

setup:
  # This will create a gitlab site based on the url, ie git.url to store and commit sites and the nwp itself.
  creategitlab: n


recipes:
  os:
    source: goalgorilla/social_template:dev-master
    install_modules: 
    profile: social
    webroot:  html
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto:  y
  d:
    source: drupal/recommended-project:^10.2
    install_modules:
    profile: standard
    webroot:  web
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto:  y
  nwp:
    source: goalgorilla/social_template:dev-master
    install_modules: git@github.com:rjzaar/workflow_assignment.git drupal/ultimate_cron:^2.0.0-alpha7
    profile: social
    webroot:  html
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto:  y
  m:
    type: moodle
    source: https://github.com/moodle/moodle.git
    branch: MOODLE_404_STABLE
    webroot: .
    sitename: "My Moodle Site"
    auto: y
  dm:
    source: drupal/recommended-project:^10.2
    install_modules: git@github.com:rjzaar/divine_mercy.git
    profile: standard
    webroot:  web
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto:  y

  # Enhanced recipe example with full environment configuration (NWP v0.2+)
  # This recipe shows how to override default settings from settings section
  enhanced_example:
    source: goalgorilla/social_template:dev-master
    profile: social
    webroot: html
    auto: y

    # Directory paths
    private: ../private              # Private files directory
    cmi: ../cmi                       # Configuration management directory

    # Environment configuration (overrides settings.environment)
    environment:
      development:
        debug: true                   # Enable debug mode
        xdebug: true                  # Enable XDebug (overrides default false)
        database_import: always       # Always import database
        stage_file_proxy: true        # Use stage_file_proxy module (overrides default false)
        stage_file_proxy_origin: https://www.example.com
      staging:
        debug: false
        database_sanitize: true       # Sanitize database on import
        stage_file_proxy: true
        stage_file_proxy_origin: https://www.example.com
      production:
        debug: false
        database_sanitize: false
        redis: true                   # Enable Redis in production
        caching: aggressive           # Aggressive caching

    # Services configuration (overrides settings.services)
    services:
      redis:
        enabled: true                 # Enable Redis (overrides default false)
        version: "7"
      solr:
        enabled: true                 # Enable Solr (overrides default false)
        core: social                  # Solr core name (overrides default 'drupal')
      memcache:
        enabled: false

    # Development configuration
    dev_modules: devel kint webprofiler stage_file_proxy  # Dev Drupal modules
    dev_composer: drupal/devel drupal/stage_file_proxy    # Dev composer packages

    # Deployment configuration
    reinstall_modules: custom_module  # Modules to reinstall during sync
    prod_method: rsync                # Production method: git, tar, rsync

    # Linode/SSH-based production (if prod_method: rsync or ssh)
    prod_server: linode_primary       # Reference to linode.servers entry
    prod_domain: example.com          # Production domain name
    prod_path: /var/www/sitename      # Remote deployment path

    # Alternative: Direct SSH alias (if not using linode.servers)
    # prod_alias: user@prod.example.com:/var/www/sitename

    # Git-based production (if prod_method: git)
    # prod_gitrepo: git@github.com:user/site.git
    # prod_gitdb: git@github.com:user/site-db.git

    # Additional options
    force: false                      # Force config imports
    # lando: false                    # Use Lando instead of DDEV
    # secrets_file: .secrets.yml      # Custom secrets file location
  test_nwp:
    source: goalgorilla/social_template:dev-master
    profile: social
    webroot: html
    auto: y
    dev_modules: devel kint webprofiler
    dev_composer: drupal/devel
  gitlab:
    type: gitlab
    source: https://gitlab.com/gitlab-org/gitlab-foss.git
    branch: master
    webroot: .
    sitename: "GitLab Instance"
    auto: y

# Linode production server configuration
# Store SSH credentials, API tokens, server IPs, and domain names for production deployments
linode:
  servers:
    linode_primary:
      ssh_user: deploy                     # SSH username for deployment
      ssh_host: 203.0.113.10               # Server IP or hostname
      ssh_port: 22                         # SSH port (default: 22)
      ssh_key: ~/.ssh/nwp                  # Path to SSH private key (optional, uses default if not specified)
      api_token: ${LINODE_API_TOKEN}       # Linode API token (use environment variable)
      server_ips:
        - 203.0.113.10                     # Primary IP
      domains:
        - example.com                      # Primary domain
        - www.example.com                  # Additional domains
    linode_backup:
      ssh_user: deploy
      ssh_host: 203.0.113.20
      ssh_port: 22
      ssh_key: ~/.ssh/nwp                  # Path to SSH private key (optional)
      api_token: ${LINODE_API_TOKEN}
      server_ips:
        - 203.0.113.20
      domains:
        - backup.example.com

# Sites tracking
# Automatically populated when sites are created with install.sh
# Stores site metadata, production configuration, and deployment settings
sites:
  # Example site entry (created by install.sh)
  # nwp:
  #   directory: /home/rob/nwp/nwp              # Full path to site directory
  #   recipe: nwp                                # Recipe used for installation
  #   environment: development                   # Environment type: development/staging/production
  #   created: 2024-12-28T10:30:00Z             # ISO 8601 timestamp
  #   installed_modules:                         # Additional modules installed
  #     - workflow_assignment
  #     - ultimate_cron
  #   production_config:                         # Production deployment configuration
  #     method: rsync                            # Deployment method: rsync/git/tar
  #     server: linode_primary                   # Reference to linode.servers entry
  #     remote_path: /var/www/nwp               # Remote deployment path
  #     domain: nwp.example.com                  # Production domain
  #
  # mysite_stg:
  #   directory: /home/rob/nwp/mysite_stg
  #   recipe: enhanced_example
  #   environment: staging
  #   created: 2024-12-28T11:00:00Z
  #   installed_modules:
  #     - custom_module
  #   production_config:
  #     method: rsync
  #     server: linode_primary
  #     remote_path: /var/www/mysite
  #     domain: staging.example.com
