# report

Error reporting wrapper that creates pre-filled GitLab issues for failed commands.

## Overview

The `report` command wraps NWP commands and offers to create GitLab issues when they fail. It captures command output, system information, and generates pre-filled issue URLs with sanitized data.

## Usage

### Wrapper Mode
```bash
pl report [options] <script> [script arguments...]
```

### Direct Report Mode
```bash
pl report --report "Error description"
pl report --report -s backup.sh "Error message"
```

## Options

| Flag | Description |
|------|-------------|
| `-c, --copy` | Copy issue URL to clipboard instead of opening browser |
| `-h, --help` | Show help message |
| `--report` | Switch to direct report mode (manual issue creation) |

## Examples

### Run backup with error reporting
```bash
pl report backup.sh mysite
```

### Run install with arguments
```bash
pl report install.sh d mysite
```

### Copy URL instead of opening browser
```bash
pl report -c backup.sh mysite
```

### Manual error report
```bash
pl report --report "Backup failed with exit code 1"
```

### Manual report with script name
```bash
pl report --report -s backup.sh "Database dump failed"
```

## Wrapper Behavior

When a command fails, you'll be prompted:

```
Report this error? [y/N/c]
```

- `y` = Yes, open GitLab issue
- `N` = No, just exit (default)
- `c` = Continue (don't exit, useful for batch operations)

## What Gets Reported

The error report includes:

1. **Command Information**:
   - Script name and arguments
   - Exit code
   - Command output (sanitized)

2. **System Information**:
   - NWP version (git commit)
   - Git branch
   - OS name and version
   - DDEV version
   - Docker version
   - Bash version

3. **Issue Template**:
   - Description section
   - Environment section
   - Command output section
   - Steps to reproduce
   - Additional context area

## Output Sanitization

The reporter automatically sanitizes:
- Home directory paths (replaced with ~)
- IP addresses
- Passwords in URLs
- API tokens and keys
- Other sensitive patterns

## Browser Integration

The command attempts to open GitLab in your browser using:
- `xdg-open` (Linux)
- `open` (macOS)
- `wslview` (WSL)

If no browser tool is found, it prints the URL.

## Clipboard Integration

With `-c` flag, copies URL using:
- `xclip` (Linux X11)
- `xsel` (Linux X11 alternative)
- `pbcopy` (macOS)
- `wl-copy` (Wayland)

## GitLab Issue Format

Generated issues include:
- **Title**: "Error in {script}: exit code {code}"
- **Labels**: `bug`
- **Description**: Formatted with markdown
- **Co-authored**: Tagged as generated by Claude Code

## Configuration

GitLab project URL is hardcoded to:
```
https://git.nwpcode.org/root/nwp
```

## Exit Codes

The wrapper preserves the exit code of the wrapped command:
- Successful commands exit with 0
- Failed commands exit with their original exit code
- Continuing (c option) exits with 0 to allow batch operations

## Non-Interactive Use

The reporter detects non-interactive terminals and skips prompting, making it safe to use in scripts and automation.

## Related Commands

- All NWP commands can be wrapped with report
- [verify.sh](verify.md) - Verification runner that could benefit from error reporting
- [contribute.sh](contribute.md) - Submit fixes for reported issues

## See Also

- GitLab Issues: https://git.nwpcode.org/root/nwp/-/issues
- Bug reporting guidelines
