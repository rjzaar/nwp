# NWP Roadmap - Pending & Future Work

**Last Updated:** January 5, 2026

Pending implementation items and future improvements for NWP.

> **For completed work, see [MILESTONES.md](MILESTONES.md)** (P01-P31)

---

## Current Status

| Metric | Value |
|--------|-------|
| Current Version | v0.12 |
| Test Success Rate | 98% |
| Completed Proposals | P01-P31 (100%) |
| Pending Proposals | P32-P35, F01-F03 |

---

## Phase Overview

| Phase | Focus | Proposals | Status |
|-------|-------|-----------|--------|
| Phase 1-5b | Foundation through Import | P01-P31 | âœ… Complete |
| **Phase 5c** | **Live Deployment Automation** | **P32-P35** | **Pending** |
| **Phase 6** | **AI & Visual Testing** | **F01-F03** | **Future** |

---

## Phase 5c: Live Deployment Automation (PENDING)

Addresses automation gaps discovered during AVC recipe installation and live deployment. Reduces manual steps from 11 to 3 commands.

### P32: Profile Module Symlink Auto-Creation
**Status:** PENDING | **Priority:** CRITICAL | **Effort:** Low | **Dependencies:** None

When `install_git_profile()` clones a profile to `profiles/custom/<profile>/`, Drupal doesn't automatically discover modules in that profile's `modules/` directory. This requires manual symlink creation.

**Solution:** Modify `install_git_profile()` in `lib/install-common.sh` to:
- Scan `$profile_path/modules/` after cloning
- Create symlinks in `$webroot/modules/custom/` for each module
- Similarly handle `$profile_path/themes/`

**Success Criteria:**
- [ ] `install_git_profile()` creates module symlinks automatically
- [ ] `install_git_profile()` creates theme symlinks automatically
- [ ] AVC recipe installs without manual intervention
- [ ] Existing recipes (d, nwp, os) unaffected

---

### P33: Live Server Infrastructure Setup
**Status:** PENDING | **Priority:** HIGH | **Effort:** Medium | **Dependencies:** P32

Create `lib/live-server-setup.sh` with functions for remote server provisioning:

**Functions:**
- `ensure_php_fpm()` - Install/configure PHP-FPM with correct socket permissions
- `ensure_mariadb()` - Install/configure MariaDB
- `create_site_database()` - Create database, user, and grants
- `configure_nginx_drupal()` - Add nginx vhost for Drupal site

**Success Criteria:**
- [ ] `lib/live-server-setup.sh` created with all functions
- [ ] Functions work on Ubuntu 22.04/24.04 Linode instances
- [ ] Integration with GitLab's bundled nginx
- [ ] Idempotent execution (safe to run multiple times)

---

### P34: Database Deployment in stg2live.sh
**Status:** PENDING | **Priority:** HIGH | **Effort:** Low | **Dependencies:** P33

Add database sync functionality to `stg2live.sh`:

**Solution:** Add `deploy_database()` function to:
- Export database from staging via `ddev export-db`
- Copy to live server via SCP
- Import on live server via mysql CLI
- Clean up temporary files

**Success Criteria:**
- [ ] `deploy_database()` function added to stg2live.sh
- [ ] Database exported, transferred, and imported successfully
- [ ] Temporary files cleaned up
- [ ] Error handling with clear messages

---

### P35: Production Settings Generation
**Status:** PENDING | **Priority:** HIGH | **Effort:** Low | **Dependencies:** P33

Add `generate_live_settings()` to `lib/install-common.sh`:

**Solution:** Generate `settings.local.php` with:
- Production database credentials (localhost, not DDEV's `db`)
- Generated hash_salt
- Production performance settings (CSS/JS aggregation, error hiding)
- Trusted host patterns

**Success Criteria:**
- [ ] `generate_live_settings()` function created
- [ ] settings.local.php generated with production values
- [ ] settings.php includes settings.local.php
- [ ] Credentials stored securely in `.secrets.data.yml`

---

### Phase 5c Complete When:
- [ ] Profile module symlinks created automatically by install_git_profile()
- [ ] Live server infrastructure provisioned by lib/live-server-setup.sh
- [ ] Database deployed by stg2live.sh deploy_database()
- [ ] Production settings generated by generate_live_settings()
- [ ] Manual steps reduced from 11 to 3 commands

---

## Phase 6: AI & Visual Testing (FUTURE)

### F01: GitLab MCP Integration for Claude Code
**Status:** PLANNED | **Priority:** MEDIUM | **Effort:** Low | **Dependencies:** NWP GitLab server

Enable Claude Code to directly interact with NWP GitLab via the Model Context Protocol (MCP):

**Benefits:**
- Claude can fetch CI logs directly without manual copy/paste
- Automatic investigation of CI failures
- Create issues for bugs found during code review
- Monitor pipeline status in real-time

**Implementation:**
1. Generate GitLab personal access token during setup
2. Store token in `.secrets.yml`
3. Configure MCP server in Claude Code
4. Add MCP configuration to `cnwp.yml`

**Success Criteria:**
- [ ] Token generated during GitLab setup
- [ ] Token stored in .secrets.yml
- [ ] MCP server configurable via setup.sh
- [ ] Claude can fetch CI logs via MCP

---

### F02: Automated CI Error Resolution
**Status:** PLANNED | **Priority:** LOW | **Effort:** Medium | **Dependencies:** F01

Extend MCP integration to automatically detect and fix common CI errors:

**Auto-fixable Errors:**
| Error Type | Detection | Auto-fix |
|------------|-----------|----------|
| PHPCS style | `phpcs` output | `phpcbf --fix` |
| Missing docblock | PHPStan error | Add docblock template |
| Unused import | PHPStan error | Remove import |

**Success Criteria:**
- [ ] Common PHPCS errors auto-fixed
- [ ] Issues created for complex errors
- [ ] Notification sent with resolution status

---

### F03: Visual Regression Testing (VRT)
**Status:** IN PROGRESS | **Priority:** MEDIUM | **Effort:** Medium | **Dependencies:** Behat BDD Framework

Automated visual regression testing using BackstopJS:

**Implementation:**
1. DDEV BackstopJS addon: `ddev get mmunz/ddev-backstopjs`
2. Configure scenarios for critical pages
3. Define viewports: mobile (375px), tablet (768px), desktop (1280px)
4. Integrate with GitLab CI pipeline

**Commands:**
```bash
ddev backstop reference     # Create baseline screenshots
ddev backstop test          # Compare against baseline
ddev backstop approve       # Approve changes as new baseline
```

**Success Criteria:**
- [x] DDEV BackstopJS addon installed
- [ ] Configuration created for test site
- [ ] Baseline screenshots captured
- [ ] Visual comparison tests pass
- [ ] GitLab CI stage integrated
- [ ] `pl vrt` command available

---

## Priority Matrix

| Proposal | Priority | Effort | Dependencies | Phase |
|----------|----------|--------|--------------|-------|
| **P32** | **CRITICAL** | Low | None | 5c |
| P33 | HIGH | Medium | P32 | 5c |
| P34 | HIGH | Low | P33 | 5c |
| P35 | HIGH | Low | P33 | 5c |
| F01 | MEDIUM | Low | GitLab | 6 |
| F02 | LOW | Medium | F01 | 6 |
| F03 | MEDIUM | Medium | Behat | 6 |

---

## References

- [MILESTONES.md](MILESTONES.md) - Completed implementation history
- [SCRIPTS_IMPLEMENTATION.md](SCRIPTS_IMPLEMENTATION.md) - Script architecture
- [CICD.md](CICD.md) - CI/CD pipeline setup
- [TESTING.md](TESTING.md) - Testing framework

---

*Document restructured: January 5, 2026*
*Completed phases (P01-P31) moved to MILESTONES.md*
