# This is the config file for the Narrow Way Project
# The aim is to put reasonable default values to make running the nwp easy
# particularly for beginners.

# This recipe section will have defaults to easy start a new project.
settings:
  # Stack settings
  database: mariadb
  php: 8.2
  webserver: nginx
  os: ubuntu

  # CLI settings
  # Do you want to install nwp with a universal cli prompt for scipts, eg 'pl' ie instead of only running
  # the install script in the root nwp directory, it could be run from anywhere using the command 'pl'
  # eg 'pl install d' anywhere instead of './install d' only in the nwp directory.
  cli: y
  cliprompt: pl

  # Deployment settings
  # linodeuse: testing/gitlab/all. If left blank it means no use.
  linodeuse: all
  # urluse: testing/gitlab/all. If left blank it means no use.
  urluse: all
  # url is for providing live tests and nwp site.
  url: nwpcode.org

  # Default environment configuration (can be overridden per recipe)
  environment:
    development:
      debug: true                   # Enable debug mode
      xdebug: false                 # XDebug off by default
      database_import: always       # Always import database
      stage_file_proxy: false       # Disabled by default
    staging:
      debug: false
      database_sanitize: true       # Sanitize database on import
      stage_file_proxy: true
    production:
      debug: false
      database_sanitize: false
      redis: true                   # Enable Redis in production
      caching: aggressive

  # Default services configuration (can be overridden per recipe)
  services:
    redis:
      enabled: false                # Redis disabled by default
      version: "7"
    solr:
      enabled: false                # Solr disabled by default
      version: "8"
      core: drupal
    memcache:
      enabled: false

  # Site management settings
  delete_site_yml: true             # Remove site from cnwp.yml when deleted (use --keep-yml to preserve)

setup:
  # This will create a gitlab site based on the url, ie git.url to store and commit sites and the nwp itself.
  creategitlab: y

# Recipe definitions
# Each recipe defines how to install a specific type of site (Drupal, Moodle, etc.)
# Required fields: source, webroot
# Optional fields: profile, install_modules, type, branch, sitename, auto
recipes:
  os:
    source: goalgorilla/social_template:dev-master
    install_modules: 
    profile: social
    webroot:  html
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto:  y
  d:
    source: drupal/recommended-project:^10.2
    install_modules:
    profile: standard
    webroot:  web
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto:  y
  nwp:
    source: goalgorilla/social_template:dev-master
    install_modules: rjzaar/workflow_assignment:dev-main drupal/ultimate_cron:^2.0.0-alpha7
    profile: social
    webroot:  html
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto:  y
  m:
    type: moodle
    source: https://github.com/moodle/moodle.git
    branch: MOODLE_404_STABLE
    webroot: .
    sitename: "My Moodle Site"
    auto: y
  dm:
    source: drupal/recommended-project:^10.2
    install_modules: git@github.com:rjzaar/divine_mercy.git
    profile: standard
    webroot:  web
    #    sitename: default # leave blank it will be called the name of the site, eg loc
    auto: y

  # Enhanced recipe example with deployment configuration (Section 5.1)
  enhanced_example:
    source: goalgorilla/social_template:dev-master
    profile: social
    webroot: html
    auto: y
    # Directory paths
    private: ../private              # Private files directory
    cmi: ../cmi                       # Configuration management directory
    # Development configuration
    dev_modules: devel kint webprofiler stage_file_proxy  # Dev Drupal modules
    dev_composer: drupal/devel drupal/stage_file_proxy    # Dev composer packages
    # Deployment configuration
    reinstall_modules: custom_module  # Modules to reinstall during sync
    prod_method: rsync                # Production method: git, tar, rsync

    # Linode/SSH-based production (if prod_method: rsync or ssh)
    prod_server: linode_primary       # Reference to linode.servers entry
    prod_domain: nwpcode.org          # Production domain name
    prod_path: /var/www/sitename      # Remote deployment path

    # Alternative: Direct SSH alias (if not using linode.servers)
    # prod_alias: user@prod.example.com:/var/www/sitename

    # Git-based production (if prod_method: git)
    # prod_gitrepo: git@github.com:user/site.git
    # prod_gitdb: git@github.com:user/site-db.git

    # Additional options
    force: false                      # Force config imports
    # lando: false                    # Use Lando instead of DDEV
  gitlab:
    type: gitlab
    source: https://gitlab.com/gitlab-org/gitlab-foss.git
    branch: master
    webroot: .
    sitename: "GitLab Instance"
    auto: y

  # Migration recipe - used for importing existing sites
  # Creates a stub directory for migration workflow
  migration:
    type: migration
    description: "Migration stub for importing existing sites"
    # No source needed - creates empty directory structure

# Linode production server configuration
# Store SSH credentials, API tokens, server IPs, and domain names for production deployments
linode:
  servers:
    linode_primary:
      ssh_user: deploy                     # SSH username for deployment
      ssh_host: 203.0.113.10               # Server IP or hostname (replace with your actual IP)
      ssh_port: 22                         # SSH port (default: 22)
      api_token: ${LINODE_API_TOKEN}       # Linode API token (use environment variable)
      server_ips:
        - 203.0.113.10                     # Primary IP
      domains:
        - nwpcode.org                      # Primary domain from settings.url

# Sites tracking
# Automatically populated when sites are created with install.sh
# Stores site metadata, production configuration, and deployment settings
sites:
  nwp5:
    directory: /home/rob/nwp/nwp5
    recipe: nwp
    environment: development
    created: 2025-12-28T15:33:16Z
    installed_modules:
      - rjzaar/workflow_assignment:dev-main
      - drupal/ultimate_cron:^2.0.0-alpha7


  test-nwp2:
    directory: /home/rob/nwp/test-nwp2
    recipe: test-nwp
    environment: development
    created: 2025-12-28T21:16:25Z
  test-nwp3:
    directory: /home/rob/nwp/test-nwp3
    recipe: test-nwp
    environment: development
    created: 2025-12-28T21:29:56Z
  test-nwp5:
    directory: /home/rob/nwp/test-nwp5
    recipe: test-nwp
    environment: development
    created: 2025-12-29T04:15:59Z
  nwp6:
    directory: /home/rob/nwp/nwp6
    recipe: nwp
    environment: development
    created: 2025-12-29T04:18:23Z
    installed_modules:
      - rjzaar/workflow_assignment:dev-main
      - drupal/ultimate_cron:^2.0.0-alpha7
  avc:
    directory: /home/rob/nwp/avc
    recipe: nwp
    environment: development
    created: 2025-12-29T07:25:42Z
    installed_modules:
      - rjzaar/workflow_assignment:dev-main
      - drupal/ultimate_cron:^2.0.0-alpha7

  test-nwp:
    source: goalgorilla/social_template:dev-master
    profile: social
    webroot: html
    auto: y
