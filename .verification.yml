# NWP Feature Verification Tracking
#
# This file tracks which features have been manually verified by a human.
# When code is modified, the verification status is automatically invalidated.
#
# Fields:
#   verified: true/false - whether a human has verified this feature
#   verified_by: name of the person who verified
#   verified_at: timestamp of verification
#   file_hash: SHA256 hash of the file(s) when verified (used to detect changes)
#   notes: optional notes about the verification
#
# Run ./verify.sh to view and manage verification status

version: 1

features:
  # ============================================================
  # CORE SCRIPTS
  # ============================================================

  setup:
    name: "Setup Script (setup.sh)"
    description: "NWP prerequisites setup - Docker, DDEV, mkcert, Linode CLI, GitLab"
    files:
      - setup.sh
    checklist:
      - "Run setup.sh on a fresh system and verify all prerequisites install"
      - "Test Docker installation and verify ddev starts correctly"
      - "Verify mkcert generates valid local certificates"
      - "Test Linode CLI authentication if configured"
      - "Check that all error messages are clear and actionable"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: "3797d2ec18d9d499f4452dc3178fd9ad2eedd583cfad3ea228baf3543da7bf1b"
    notes: "Auto-invalidated: files changed"

  install:
    name: "Install Script (install.sh)"
    description: "Main installation script - reads cnwp.yml and installs sites"
    files:
      - install.sh
      - lib/install-common.sh
      - lib/install-drupal.sh
      - lib/install-steps.sh
    checklist:
      - "Test fresh install with each recipe type (nwp, d, os, dm)"
      - "Verify site starts and is accessible via browser"
      - "Check admin login works with generated credentials"
      - "Test install with --list and --steps flags"
      - "Verify cnwp.yml is updated correctly after install"
      - "Test re-running install on existing site (should skip/warn)"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  status:
    name: "Status Script (status.sh)"
    description: "Status display, health checks, and site management"
    files:
      - status.sh
    checklist:
      - "Run status.sh with no arguments - verify all sites listed"
      - "Run status.sh <sitename> - verify detailed info shown"
      - "Check running/stopped status is accurate"
      - "Verify URLs displayed are correct and accessible"
      - "Test health check indicators (database, files, config)"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  modify:
    name: "Modify Script (modify.sh)"
    description: "Interactive TUI for modifying site options"
    files:
      - modify.sh
    checklist:
      - "Run modify.sh <sitename> and navigate TUI menus"
      - "Test changing site options (theme, modules, etc.)"
      - "Verify changes are saved to cnwp.yml correctly"
      - "Test cancel/exit without saving"
      - "Check keyboard navigation (arrows, enter, escape)"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  backup:
    name: "Backup Script (backup.sh)"
    description: "Site backup with database, files, git backup, and sanitization"
    files:
      - backup.sh
      - lib/git.sh
      - lib/sanitize.sh
    checklist:
      - "Test full backup: ./backup.sh <sitename>"
      - "Test database-only backup: ./backup.sh -b <sitename>"
      - "Verify backup files created in sitebackups/<sitename>/"
      - "Test --sanitize basic and --sanitize full flags"
      - "Test --git flag pushes to GitLab repository"
      - "Test --bundle creates git bundle file"
      - "Verify backup naming convention includes timestamp"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  restore:
    name: "Restore Script (restore.sh)"
    description: "Site restoration from backups"
    files:
      - restore.sh
      - lib/rollback.sh
    checklist:
      - "Test restore from full backup"
      - "Test restore from database-only backup"
      - "Verify interactive backup selection works"
      - "Test restore with specific backup file path"
      - "Verify site works correctly after restore"
      - "Test restore to different site name"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  sync:
    name: "Sync Script (sync.sh)"
    description: "Re-sync imported sites with remote sources"
    files:
      - sync.sh
    checklist:
      - "Test sync with an imported site"
      - "Verify database is updated from remote"
      - "Check files are synced correctly"
      - "Test sync with --files-only flag"
      - "Verify local changes are not overwritten unexpectedly"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  copy:
    name: "Copy Script (copy.sh)"
    description: "Copy/duplicate existing sites"
    files:
      - copy.sh
    checklist:
      - "Test full copy: ./copy.sh source dest"
      - "Test files-only copy: ./copy.sh -f source dest"
      - "Verify copied site starts and runs independently"
      - "Check database is correctly duplicated"
      - "Verify cnwp.yml is updated with new site"
      - "Test copy to existing site (should warn/fail)"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  delete:
    name: "Delete Script (delete.sh)"
    description: "Site deletion with safety checks"
    files:
      - delete.sh
    checklist:
      - "Test delete with confirmation prompt"
      - "Test delete with -y auto-confirm flag"
      - "Test delete with -b backup flag (creates backup first)"
      - "Verify DDEV project is stopped and removed"
      - "Verify site directory is removed"
      - "Check cnwp.yml is updated to remove site"
      - "Test protection of production sites (should warn)"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  make:
    name: "Make Script (make.sh)"
    description: "Site mode switching (dev/staging/production)"
    files:
      - make.sh
    checklist:
      - "Test dev mode: ./make.sh -v <sitename>"
      - "Test prod mode: ./make.sh -p <sitename>"
      - "Verify dev mode enables devel module and disables caching"
      - "Verify prod mode uninstalls dev modules and enables caching"
      - "Check CSS/JS aggregation settings change correctly"
      - "Test with -y auto-confirm flag"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  migration:
    name: "Migration Script (migration.sh)"
    description: "Site migrations from various sources to Drupal 11"
    files:
      - migration.sh
    checklist:
      - "Test migration from Drupal 7 source"
      - "Test migration from Drupal 9/10 source"
      - "Verify content types are migrated correctly"
      - "Check users and roles are migrated"
      - "Verify media/files are migrated"
      - "Test migration rollback if available"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  import:
    name: "Import Script (import.sh)"
    description: "Import existing sites from remote sources"
    files:
      - import.sh
      - lib/import.sh
      - lib/import-tui.sh
      - lib/server-scan.sh
    checklist:
      - "Test import from SSH remote server"
      - "Test interactive server scanning"
      - "Verify database is imported correctly"
      - "Check files are downloaded and placed correctly"
      - "Verify imported site starts and runs"
      - "Test import with specific database/files paths"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # DEPLOYMENT SCRIPTS
  # ============================================================

  live:
    name: "Live Provisioning (live.sh)"
    description: "Live server provisioning at sitename.nwpcode.org"
    files:
      - live.sh
    checklist:
      - "Test Linode server creation (use test mode if available)"
      - "Verify DNS configuration with Cloudflare"
      - "Check SSL certificate is installed correctly"
      - "Verify site is accessible at sitename.nwpcode.org"
      - "Test SSH access to provisioned server"
      - "Verify firewall rules are applied"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  dev2stg:
    name: "Dev to Staging (dev2stg.sh)"
    description: "Deploy from dev to staging with TUI, multi-source DB, and testing"
    files:
      - dev2stg.sh
      - lib/state.sh
      - lib/database-router.sh
      - lib/testing.sh
      - lib/preflight.sh
      - lib/dev2stg-tui.sh
    checklist:
      - "Test preflight only: ./dev2stg.sh --preflight <sitename>"
      - "Test TUI mode: ./dev2stg.sh <sitename> (navigate DB and test menus)"
      - "Test automated mode: ./dev2stg.sh -y <sitename>"
      - "Test auto-staging creation when staging doesn't exist"
      - "Test database sources: auto, production, backup, development"
      - "Test with --fresh-backup flag (requires production access)"
      - "Test with --dev-db flag (clones from development)"
      - "Test test presets: -t quick, -t essential, -t full, -t skip"
      - "Test custom test selection: -t phpunit,phpstan"
      - "Verify all 11 deployment steps complete successfully"
      - "Verify staging has production mode (caching enabled, dev modules off)"
      - "Verify database sanitization (user emails anonymized)"
      - "Test step resume: ./dev2stg.sh -s 5 <sitename>"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Enhanced with TUI, multi-source DB, testing - January 2026"

  stg2prod:
    name: "Staging to Production (stg2prod.sh)"
    description: "Deploy from staging to production"
    files:
      - stg2prod.sh
    checklist:
      - "Test deployment with backup: ./stg2prod.sh -b <sitename>"
      - "Verify backup is created before deployment"
      - "Check production site is updated correctly"
      - "Verify production mode is enforced"
      - "Test database sync options"
      - "Verify rollback procedure if deployment fails"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  prod2stg:
    name: "Production to Staging (prod2stg.sh)"
    description: "Sync production back to staging"
    files:
      - prod2stg.sh
    checklist:
      - "Test sync: ./prod2stg.sh <sitename>"
      - "Verify production database is copied to staging"
      - "Check files are synced correctly"
      - "Verify staging still has dev code (code not synced)"
      - "Test sanitization option if available"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  stg2live:
    name: "Staging to Live (stg2live.sh)"
    description: "Deploy staging to live server"
    files:
      - stg2live.sh
    checklist:
      - "Test deployment to live server"
      - "Verify files are synced via rsync/SSH"
      - "Check database is deployed correctly"
      - "Verify live site is accessible"
      - "Test with dry-run mode if available"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  live2stg:
    name: "Live to Staging (live2stg.sh)"
    description: "Promote live back to staging"
    files:
      - live2stg.sh
    checklist:
      - "Test sync from live to local staging"
      - "Verify database is downloaded and imported"
      - "Check files are synced correctly"
      - "Verify staging runs with live content"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  live2prod:
    name: "Live to Production (live2prod.sh)"
    description: "Promote live to production"
    files:
      - live2prod.sh
    checklist:
      - "Test promotion to production environment"
      - "Verify backup is created before promotion"
      - "Check production site is updated"
      - "Test rollback procedure"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  produce:
    name: "Produce Script (produce.sh)"
    description: "Production environment setup"
    files:
      - produce.sh
    checklist:
      - "Test production environment creation"
      - "Verify production settings are applied"
      - "Check security hardening is enabled"
      - "Verify caching and performance settings"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # INFRASTRUCTURE SCRIPTS
  # ============================================================

  podcast:
    name: "Podcast Infrastructure (podcast.sh)"
    description: "Castopod podcast hosting infrastructure"
    files:
      - podcast.sh
      - lib/podcast.sh
      - lib/install-podcast.sh
    checklist:
      - "Test podcast site creation"
      - "Verify Castopod is installed correctly"
      - "Check podcast admin interface works"
      - "Test podcast RSS feed generation"
      - "Verify media upload functionality"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  schedule:
    name: "Schedule Script (schedule.sh)"
    description: "Backup and sync scheduling"
    files:
      - schedule.sh
    checklist:
      - "Test schedule creation for backups"
      - "Verify cron jobs are created correctly"
      - "Check scheduled backups run as expected"
      - "Test schedule removal"
      - "Verify schedule listing works"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  security:
    name: "Security Script (security.sh)"
    description: "Security hardening and configuration"
    files:
      - security.sh
    checklist:
      - "Test security audit: ./security.sh audit <sitename>"
      - "Test security check: ./security.sh check <sitename>"
      - "Test security update: ./security.sh update <sitename>"
      - "Verify file permissions are checked correctly"
      - "Check dev module detection works"
      - "Verify exposed file detection works"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  setup_ssh:
    name: "SSH Setup (setup-ssh.sh)"
    description: "SSH key generation and management"
    files:
      - setup-ssh.sh
    checklist:
      - "Test SSH key generation"
      - "Verify keys are created in keys/ directory"
      - "Check key is installed to ~/.ssh/nwp"
      - "Test connection to remote server with generated key"
      - "Verify public key output for Linode"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  uninstall:
    name: "Uninstall Script (uninstall_nwp.sh)"
    description: "Complete NWP uninstallation"
    files:
      - uninstall_nwp.sh
    checklist:
      - "Test in dry-run mode if available"
      - "Verify all DDEV projects are stopped"
      - "Check NWP directories are removed"
      - "Verify Docker resources are cleaned up"
      - "Test partial uninstall options if available"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # CLI & TESTING
  # ============================================================

  pl_cli:
    name: "PL CLI Wrapper (pl)"
    description: "Universal CLI wrapper - main command interface"
    files:
      - pl
    checklist:
      - "Test pl command with various subcommands"
      - "Verify pl install works"
      - "Verify pl backup works"
      - "Check pl status works"
      - "Test tab completion if available"
      - "Verify help output is correct"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  test_nwp:
    name: "Test Suite (test-nwp.sh)"
    description: "Comprehensive test suite - 22 test categories"
    files:
      - test-nwp.sh
      - test.sh
      - testos.sh
    checklist:
      - "Run full test suite: ./test-nwp.sh"
      - "Verify all test categories pass"
      - "Check test output is clear and readable"
      - "Test individual test categories"
      - "Verify testos.sh OpenSocial tests work"
      - "Check Behat/PHPUnit integration if applicable"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # LIBRARY MODULES
  # ============================================================

  lib_tui:
    name: "TUI Library (lib/tui.sh)"
    description: "Terminal UI framework - menus, checkboxes, forms"
    files:
      - lib/tui.sh
    checklist:
      - "Test menu display and navigation"
      - "Verify checkbox selection works"
      - "Test form input fields"
      - "Check color rendering in different terminals"
      - "Verify keyboard shortcuts work correctly"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_checkbox:
    name: "Checkbox Library (lib/checkbox.sh)"
    description: "Advanced interactive checkbox selection"
    files:
      - lib/checkbox.sh
    checklist:
      - "Test checkbox display with multiple items"
      - "Verify space bar toggles selection"
      - "Check arrow key navigation"
      - "Test Enter to confirm selection"
      - "Verify Escape to cancel"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_yaml_write:
    name: "YAML Write Library (lib/yaml-write.sh)"
    description: "YAML file manipulation without yq"
    files:
      - lib/yaml-write.sh
    checklist:
      - "Test reading YAML values"
      - "Test writing/updating YAML values"
      - "Verify nested value handling"
      - "Check array handling"
      - "Test with special characters in values"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_common:
    name: "Common Library (lib/common.sh)"
    description: "Common utilities - validation, secrets, prompts"
    files:
      - lib/common.sh
    checklist:
      - "Test get_secret() reads from .secrets.yml"
      - "Test get_setting() reads from cnwp.yml"
      - "Verify sitename validation"
      - "Check prompt functions work correctly"
      - "Test path handling utilities"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_ui:
    name: "UI Library (lib/ui.sh)"
    description: "Basic UI utilities - colors, status messages"
    files:
      - lib/ui.sh
    checklist:
      - "Test print_status with OK, WARN, FAIL, INFO"
      - "Verify colors display correctly"
      - "Check print_header formatting"
      - "Test print_error output"
      - "Verify ocmsg debug output"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_git:
    name: "Git Library (lib/git.sh)"
    description: "Git backup, bundling, GitLab API operations"
    files:
      - lib/git.sh
    checklist:
      - "Test git backup creation"
      - "Verify git bundle creation"
      - "Test GitLab API project creation"
      - "Check git push to remote"
      - "Verify incremental backup handling"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_cloudflare:
    name: "Cloudflare Library (lib/cloudflare.sh)"
    description: "Cloudflare DNS and SSL management"
    files:
      - lib/cloudflare.sh
    checklist:
      - "Test DNS record creation"
      - "Verify DNS record lookup"
      - "Check zone ID resolution"
      - "Test API authentication"
      - "Verify error handling for API failures"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_linode:
    name: "Linode Library (lib/linode.sh)"
    description: "Linode API operations and provisioning"
    files:
      - lib/linode.sh
    checklist:
      - "Test Linode instance creation (use test mode)"
      - "Verify instance listing"
      - "Check API token authentication"
      - "Test instance deletion"
      - "Verify error handling"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_b2:
    name: "B2 Library (lib/b2.sh)"
    description: "Backblaze B2 cloud storage integration"
    files:
      - lib/b2.sh
    checklist:
      - "Test B2 authentication"
      - "Verify file upload to B2"
      - "Test file download from B2"
      - "Check bucket listing"
      - "Verify error handling for API failures"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_remote:
    name: "Remote Library (lib/remote.sh)"
    description: "Remote server operations"
    files:
      - lib/remote.sh
    checklist:
      - "Test SSH connection to remote server"
      - "Verify file transfer via rsync"
      - "Check remote command execution"
      - "Test connection timeout handling"
      - "Verify error handling for failed connections"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  lib_badges:
    name: "Badges Library (lib/badges.sh)"
    description: "Status badge generation"
    files:
      - lib/badges.sh
    checklist:
      - "Test badge generation for passing status"
      - "Verify badge generation for failing status"
      - "Check badge output format (SVG or URL)"
      - "Test badge color coding"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # MOODLE SUPPORT
  # ============================================================

  moodle:
    name: "Moodle Installation (lib/install-moodle.sh)"
    description: "Moodle platform installation support"
    files:
      - lib/install-moodle.sh
    checklist:
      - "Test Moodle site installation with dm recipe"
      - "Verify Moodle admin interface works"
      - "Check database is configured correctly"
      - "Test course creation functionality"
      - "Verify user registration works"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # GITLAB INFRASTRUCTURE
  # ============================================================

  gitlab_setup:
    name: "GitLab Setup (git/gitlab_setup.sh)"
    description: "Main GitLab instance provisioning"
    files:
      - git/gitlab_setup.sh
      - git/gitlab_server_setup.sh
      - git/gitlab_create_server.sh
    checklist:
      - "Test GitLab server creation on Linode"
      - "Verify GitLab is accessible via HTTPS"
      - "Check admin login works"
      - "Test repository creation"
      - "Verify SSH access to GitLab"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  gitlab_hardening:
    name: "GitLab Hardening (git/gitlab_harden.sh)"
    description: "GitLab security hardening automation"
    files:
      - git/gitlab_harden.sh
    checklist:
      - "Test --check mode shows current settings"
      - "Test dry-run mode (default) shows changes"
      - "Test --apply mode applies changes"
      - "Verify all 8 hardening options work"
      - "Check gitlab.rb backup is created"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  gitlab_repo:
    name: "GitLab Repository Setup (git/setup_gitlab_repo.sh)"
    description: "Repository initialization and site integration"
    files:
      - git/setup_gitlab_repo.sh
      - git/setup_gitlab_site.sh
    checklist:
      - "Test repository creation for a site"
      - "Verify git remote is configured"
      - "Check initial commit is pushed"
      - "Test site integration with GitLab"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  gitlab_install:
    name: "GitLab Install Library (lib/install-gitlab.sh)"
    description: "GitLab instance installation via DDEV"
    files:
      - lib/install-gitlab.sh
    checklist:
      - "Test local GitLab installation via DDEV"
      - "Verify GitLab container starts"
      - "Check admin interface is accessible"
      - "Test repository operations"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # LINODE INFRASTRUCTURE
  # ============================================================

  linode_setup:
    name: "Linode Setup (linode/linode_setup.sh)"
    description: "Linode server configuration and provisioning"
    files:
      - linode/linode_setup.sh
      - linode/linode_server_setup.sh
    checklist:
      - "Test server creation (use test mode)"
      - "Verify SSH access to new server"
      - "Check server configuration is correct"
      - "Test firewall rules are applied"
      - "Verify DNS is configured"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  linode_deploy:
    name: "Linode Deploy (linode/linode_deploy.sh)"
    description: "Deployment automation to Linode servers"
    files:
      - linode/linode_deploy.sh
    checklist:
      - "Test deployment to existing server"
      - "Verify files are synced correctly"
      - "Check database is deployed"
      - "Test SSL certificate setup"
      - "Verify site is accessible"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  linode_test_server:
    name: "Linode Test Server (linode/linode_create_test_server.sh)"
    description: "Automated test server creation"
    files:
      - linode/linode_create_test_server.sh
    checklist:
      - "Test server creation for testing"
      - "Verify server is accessible"
      - "Check cleanup/deletion works"
      - "Test automated provisioning"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # CONFIGURATION
  # ============================================================

  config_example:
    name: "Example Configuration (example.cnwp.yml)"
    description: "Complete configuration template"
    files:
      - example.cnwp.yml
    checklist:
      - "Verify all recipe options are documented"
      - "Check default values are sensible"
      - "Test copying to cnwp.yml works"
      - "Verify comments explain each option"
      - "Check for any missing new options"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  config_secrets:
    name: "Secrets Example (.secrets.example.yml)"
    description: "Secrets configuration template"
    files:
      - .secrets.example.yml
    checklist:
      - "Verify all secret placeholders are present"
      - "Check structure matches .secrets.yml expectations"
      - "Verify comments explain each secret"
      - "Test copying to .secrets.yml works"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # TESTS
  # ============================================================

  tests_integration:
    name: "Integration Tests (tests/)"
    description: "Integration and unit test suites"
    files:
      - tests/test-integration.sh
      - tests/test-podcast.sh
      - tests/test-yaml-write.sh
    checklist:
      - "Run all integration tests"
      - "Verify tests pass on fresh environment"
      - "Check test output is clear"
      - "Test individual test files"
      - "Verify test coverage is adequate"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: null

  # ============================================================
  # CI/CD PIPELINE
  # ============================================================

  ci_scripts:
    name: "CI Helper Scripts (scripts/ci/)"
    description: "CI pipeline helper scripts for database, build, test, coverage"
    files:
      - scripts/ci/fetch-db.sh
      - scripts/ci/build.sh
      - scripts/ci/test.sh
      - scripts/ci/check-coverage.sh
    checklist:
      - "Test fetch-db.sh creates sanitized database backup"
      - "Test fetch-db.sh --use-cache uses cached database"
      - "Test build.sh runs composer install and npm build"
      - "Test build.sh imports database and runs drush deploy"
      - "Test test.sh runs phpcs, phpstan, phpunit, behat"
      - "Test test.sh respects --skip-* flags"
      - "Test test.sh creates logs in .logs/ directory"
      - "Test check-coverage.sh validates coverage threshold"
      - "Verify all scripts work within DDEV environment"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 1 implementation"

  gitlab_ci:
    name: "GitLab CI Configuration (.gitlab-ci.yml)"
    description: "GitLab CI/CD pipeline with database caching and multi-stage deploy"
    files:
      - .gitlab-ci.yml
    checklist:
      - "Verify pipeline triggers on push to any branch"
      - "Test nightly database job caches production database"
      - "Verify build job runs all tests"
      - "Test coverage job generates reports"
      - "Test staging deployment on merge to staging branch"
      - "Test production deployment on merge to production branch"
      - "Verify manual deployment buttons work"
      - "Test pipeline artifacts are stored correctly"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 1 implementation"

  github_actions:
    name: "GitHub Actions Workflow (.github/workflows/)"
    description: "GitHub Actions workflow with DDEV integration"
    files:
      - .github/workflows/build-test-deploy.yml
    checklist:
      - "Verify workflow triggers on push/PR/schedule"
      - "Test DDEV starts correctly in GitHub Actions"
      - "Verify database caching works"
      - "Test all test types run successfully"
      - "Test staging deployment on push to main"
      - "Test production deployment on release tag"
      - "Verify workflow concurrency limits work"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 1 implementation"

  # ============================================================
  # DEPENDENCY AUTOMATION
  # ============================================================

  renovate:
    name: "Renovate Configuration (renovate.json)"
    description: "Automated dependency updates for Drupal projects"
    files:
      - renovate.json
    checklist:
      - "Verify Renovate bot is enabled on repository"
      - "Test Drupal core update PR creation"
      - "Test contrib module update PR creation"
      - "Verify auto-merge works for patch updates"
      - "Test security alert PRs are created immediately"
      - "Check rate limiting (2 PRs/hour, 10/day)"
      - "Verify commit message format"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 2 implementation"

  security_update:
    name: "Security Update Script (scripts/security-update.sh)"
    description: "Automated security update workflow with testing"
    files:
      - scripts/security-update.sh
    checklist:
      - "Test --check mode lists available security updates"
      - "Test security branch creation (security/YYYYMMDD)"
      - "Verify composer update --dry-run shows changes"
      - "Test composer update applies changes correctly"
      - "Verify tests run after applying updates"
      - "Test commit is created with proper message"
      - "Test branch is pushed to remote"
      - "Verify summary report is accurate"
      - "Test notification is sent after update"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 2 implementation"

  # ============================================================
  # SERVER SCRIPTS
  # ============================================================

  server_bootstrap:
    name: "Server Bootstrap (linode/server_scripts/nwp-bootstrap.sh)"
    description: "Production server initialization and package installation"
    files:
      - linode/server_scripts/nwp-bootstrap.sh
    checklist:
      - "Test on fresh Ubuntu 22.04 server"
      - "Verify all packages installed (nginx, php, mysql, etc.)"
      - "Check /var/www/{prod,test,old} directories created"
      - "Verify /var/backups/nwp directory created"
      - "Check /var/log/nwp directory created"
      - "Test idempotent (runs twice without errors)"
      - "Verify firewall rules applied"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 3 implementation"

  server_healthcheck:
    name: "Server Health Check (linode/server_scripts/nwp-healthcheck.sh)"
    description: "Comprehensive health monitoring for production sites"
    files:
      - linode/server_scripts/nwp-healthcheck.sh
    checklist:
      - "Test HTTP check returns site status"
      - "Test Drupal status check via drush"
      - "Verify database connection check works"
      - "Test cache backend check"
      - "Test cron status check"
      - "Verify SSL certificate check"
      - "Test disk usage check"
      - "Test --json output format"
      - "Verify exit codes (0=healthy, 1=unhealthy)"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 3 implementation"

  server_audit:
    name: "Server Audit Logging (linode/server_scripts/nwp-audit.sh)"
    description: "Deployment and operation audit logging"
    files:
      - linode/server_scripts/nwp-audit.sh
    checklist:
      - "Test deploy action logging"
      - "Verify JSON Lines format in deployments.jsonl"
      - "Check human-readable format in deployments.log"
      - "Verify timestamps are correct"
      - "Test metadata field storage"
      - "Verify log rotation doesn't lose data"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 3 implementation"

  # ============================================================
  # NOTIFICATION SYSTEM
  # ============================================================

  notify_main:
    name: "Notification Router (scripts/notify.sh)"
    description: "Main notification script routing to multiple channels"
    files:
      - scripts/notify.sh
    checklist:
      - "Test --event flag with various event types"
      - "Test --site flag includes site name"
      - "Test --url flag includes clickable link"
      - "Verify routes to Slack when SLACK_WEBHOOK_URL set"
      - "Verify routes to email when EMAIL_RECIPIENTS set"
      - "Verify routes to webhook when WEBHOOK_URL set"
      - "Test multiple channels simultaneously"
      - "Verify event-to-emoji mapping"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 4 implementation"

  notify_slack:
    name: "Slack Notifications (scripts/notify-slack.sh)"
    description: "Slack webhook integration for deployment notifications"
    files:
      - scripts/notify-slack.sh
    checklist:
      - "Test success notification (green color)"
      - "Test error notification (red color)"
      - "Test warning notification (yellow color)"
      - "Verify message formatting in Slack"
      - "Test link attachment"
      - "Verify SLACK_WEBHOOK_URL validation"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 4 implementation"

  notify_email:
    name: "Email Notifications (scripts/notify-email.sh)"
    description: "Email notifications via sendmail/SMTP"
    files:
      - scripts/notify-email.sh
    checklist:
      - "Test email delivery via sendmail"
      - "Test email delivery via SMTP"
      - "Verify subject line formatting"
      - "Test multiple recipients"
      - "Verify HTML vs plain text formatting"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 4 implementation"

  notify_webhook:
    name: "Webhook Notifications (scripts/notify-webhook.sh)"
    description: "Generic webhook integration for external systems"
    files:
      - scripts/notify-webhook.sh
    checklist:
      - "Test JSON payload format"
      - "Verify event type in payload"
      - "Test timestamp field"
      - "Verify metadata fields"
      - "Test webhook URL validation"
      - "Test response handling"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 4 implementation"

  # ============================================================
  # CODE QUALITY
  # ============================================================

  phpstan_config:
    name: "PHPStan Configuration (phpstan.neon)"
    description: "Static analysis configuration for Drupal projects"
    files:
      - phpstan.neon
    checklist:
      - "Verify level 5 analysis runs without config errors"
      - "Test custom module scanning in web/modules/custom"
      - "Test custom theme scanning in web/themes/custom"
      - "Verify Drupal-specific ignores work"
      - "Test baseline generation if needed"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 5 implementation"

  pre_commit_hook:
    name: "Pre-commit Hook (.hooks/pre-commit)"
    description: "Git pre-commit hook for code quality checks"
    files:
      - .hooks/pre-commit
    checklist:
      - "Test hook installation to .git/hooks/"
      - "Verify PHPCS runs on staged PHP files"
      - "Verify PHPStan runs on staged PHP files"
      - "Test commit blocked on PHPCS errors"
      - "Test commit blocked on PHPStan errors"
      - "Verify --no-verify bypasses hook"
      - "Test non-PHP files skip PHP checks"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 5 implementation"

  pr_templates:
    name: "PR/MR Templates"
    description: "Pull/Merge request templates for code review"
    files:
      - .github/PULL_REQUEST_TEMPLATE.md
      - .gitlab/merge_request_templates/default.md
    checklist:
      - "Verify GitHub PR template appears on new PR"
      - "Verify GitLab MR template appears on new MR"
      - "Check all checklist items are relevant"
      - "Test markdown rendering"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 5 implementation"

  # ============================================================
  # MULTI-CODER SUPPORT
  # ============================================================

  coder_setup:
    name: "Coder Setup (coder-setup.sh)"
    description: "Multi-coder DNS delegation and management"
    files:
      - coder-setup.sh
      - lib/cloudflare.sh
    checklist:
      - "Test add coder: ./coder-setup.sh add codername"
      - "Verify NS records created in Cloudflare"
      - "Test list coders: ./coder-setup.sh list"
      - "Test remove coder: ./coder-setup.sh remove codername"
      - "Verify cnwp.yml other_coders section updated"
      - "Test DNS propagation verification"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Multi-coder infrastructure"

  # ============================================================
  # PHASE 6: MONITORING & OBSERVABILITY
  # ============================================================

  monitoring_daemon:
    name: "Monitoring Daemon (linode/server_scripts/nwp-monitor.sh)"
    description: "Continuous server monitoring with metrics collection and alerting"
    files:
      - linode/server_scripts/nwp-monitor.sh
      - linode/server_scripts/nwp-cron.conf
    checklist:
      - "Test metrics collection: ./nwp-monitor.sh --domain example.com /var/www/prod"
      - "Verify JSON metrics logged to /var/log/nwp/metrics/"
      - "Test HTTP status alerts (stop site, verify alert triggers)"
      - "Test response time alerts (configure low threshold)"
      - "Test disk usage alerts (configure low threshold)"
      - "Verify cron configuration runs every 5 minutes"
      - "Test --verbose mode for debugging"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 6 implementation"

  production_dashboard:
    name: "Production Dashboard (status.sh production)"
    description: "Production status overview with response times and backup ages"
    files:
      - status.sh
    checklist:
      - "Test ./status.sh production command"
      - "Verify production sites with live.enabled: true are shown"
      - "Check response time measurement"
      - "Verify backup age calculation"
      - "Test SSL expiry display"
      - "Verify quick stats summary"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 6 implementation"

  # ============================================================
  # PHASE 7: AUTOMATED BACKUPS & DISASTER RECOVERY
  # ============================================================

  scheduled_backup:
    name: "Scheduled Backup (linode/server_scripts/nwp-scheduled-backup.sh)"
    description: "Automated backup with rotation policies"
    files:
      - linode/server_scripts/nwp-scheduled-backup.sh
    checklist:
      - "Test database backup: ./nwp-scheduled-backup.sh prod database"
      - "Test file backup: ./nwp-scheduled-backup.sh prod files"
      - "Test full backup: ./nwp-scheduled-backup.sh prod full"
      - "Verify backup files created in /var/backups/nwp/"
      - "Test rotation (create old backups, verify cleanup)"
      - "Verify audit logging on success"
      - "Verify notification on failure"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 7 implementation"

  verify_backup:
    name: "Backup Verification (linode/server_scripts/nwp-verify-backup.sh)"
    description: "Backup integrity verification"
    files:
      - linode/server_scripts/nwp-verify-backup.sh
    checklist:
      - "Test with valid .sql.gz backup"
      - "Test with valid .tar.gz backup"
      - "Test with corrupted backup (should fail)"
      - "Test with empty file (should fail)"
      - "Verify exit codes (0=valid, 1=invalid)"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 7 implementation"

  disaster_recovery:
    name: "Disaster Recovery Documentation"
    description: "Comprehensive disaster recovery procedures"
    files:
      - docs/DISASTER_RECOVERY.md
    checklist:
      - "Review RTO targets are realistic"
      - "Test Scenario 1: Bad Deployment rollback"
      - "Test Scenario 2: Database restore from backup"
      - "Verify all referenced scripts exist"
      - "Review pre-disaster preparation checklist"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 7 implementation"

  # ============================================================
  # PHASE 8: ENVIRONMENT MANAGEMENT
  # ============================================================

  preview_environments:
    name: "Preview Environments (scripts/ci/create-preview.sh)"
    description: "PR/MR preview environment creation and cleanup"
    files:
      - scripts/ci/create-preview.sh
      - scripts/ci/cleanup-preview.sh
    checklist:
      - "Test create preview: ./scripts/ci/create-preview.sh pr-123"
      - "Verify DDEV project starts"
      - "Verify database imported from cache"
      - "Test preview URL accessibility"
      - "Test cleanup: ./scripts/ci/cleanup-preview.sh pr-123"
      - "Verify DDEV project removed"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 8 implementation"

  environments_doc:
    name: "Environments Documentation"
    description: "Environment hierarchy and configuration splits"
    files:
      - docs/ENVIRONMENTS.md
    checklist:
      - "Review environment hierarchy is accurate"
      - "Verify config split examples are correct"
      - "Check CI/CD examples for GitLab and GitHub"
      - "Review best practices section"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 8 implementation"

  # ============================================================
  # PHASE 9: ADVANCED AUTOMATION
  # ============================================================

  bluegreen_deploy:
    name: "Blue-Green Deployment (linode/server_scripts/nwp-bluegreen-deploy.sh)"
    description: "Enhanced blue-green deployment with smoke tests"
    files:
      - linode/server_scripts/nwp-bluegreen-deploy.sh
    checklist:
      - "Test basic deployment: ./nwp-bluegreen-deploy.sh --domain example.com"
      - "Test with canary mode: --canary --canary-percent 10"
      - "Verify smoke tests run on test environment"
      - "Test automatic rollback on failure"
      - "Verify health check integration"
      - "Test --dry-run mode"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 9 implementation"

  canary_release:
    name: "Canary Releases (linode/server_scripts/nwp-canary.sh)"
    description: "Canary release management with auto-promote/rollback"
    files:
      - linode/server_scripts/nwp-canary.sh
    checklist:
      - "Test deploy command: ./nwp-canary.sh deploy --domain example.com"
      - "Test status command: ./nwp-canary.sh status"
      - "Test promote command: ./nwp-canary.sh promote"
      - "Test rollback command: ./nwp-canary.sh rollback"
      - "Verify auto-promote after monitoring period"
      - "Verify auto-rollback on errors"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 9 implementation"

  perf_baseline:
    name: "Performance Baseline (linode/server_scripts/nwp-perf-baseline.sh)"
    description: "Performance baseline capture and comparison"
    files:
      - linode/server_scripts/nwp-perf-baseline.sh
    checklist:
      - "Test capture: ./nwp-perf-baseline.sh capture --domain example.com"
      - "Verify baseline stored in /var/log/nwp/baselines/"
      - "Test compare: ./nwp-perf-baseline.sh compare --domain example.com"
      - "Test regression detection (>20% slower)"
      - "Test list and show commands"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 9 implementation"

  visual_regression:
    name: "Visual Regression (scripts/ci/visual-regression.sh)"
    description: "Visual regression testing with BackstopJS integration"
    files:
      - scripts/ci/visual-regression.sh
    checklist:
      - "Test init: ./scripts/ci/visual-regression.sh init --base-url http://test.example.com"
      - "Test reference capture: ./scripts/ci/visual-regression.sh reference"
      - "Test comparison: ./scripts/ci/visual-regression.sh test"
      - "Verify report generation in .logs/visual/"
      - "Test approve command for baseline updates"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 9 implementation"

  advanced_deployment_doc:
    name: "Advanced Deployment Documentation"
    description: "Blue-green, canary, and performance tracking documentation"
    files:
      - docs/ADVANCED_DEPLOYMENT.md
    checklist:
      - "Review blue-green deployment strategy"
      - "Verify canary release examples"
      - "Check performance baseline documentation"
      - "Review visual regression setup"
    verified: false
    verified_by: null
    verified_at: null
    file_hash: null
    notes: "Added January 2026 - Phase 9 implementation"
